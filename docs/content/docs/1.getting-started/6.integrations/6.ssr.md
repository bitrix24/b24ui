---
title: SSR
description: 'Bitrix24 UI has first-party support for Vue SSR. This guide will help you have it fully enabled.'
framework: vue
---

## Usage

When using Bitrix24 UI with Nuxt.js framework, SSR server will fully work out of the box. However, when using it with pure Vue, you will need to pay attention to some details to make it function as expected.

### Color Variables Injection

Bitrix24 UI, by default, injects to the `<head>` of the document color variables that are used across all components. Since the document is not managed by the UI library in the Vue SSR, you will need to inject that manually. 

You can do that by using `@unhead` in the following way:

::code-group{sync="vite"}

```ts [ssr.ts]
import { createHead, renderSSRHead } from '@unhead/vue/server'

// Create the header with unhead
const head = createHead()

// Render SSR header and append it to the SSR application instance
const payload = await renderSSRHead(head)
app.head.push(payload.headTags)
```

```ts [resources/js/ssr.ts (Laravel Inertia)] {4,14,27,29,30,31,32,33}
import { createInertiaApp } from '@inertiajs/vue3'
import createServer from '@inertiajs/vue3/server'
import b24UiPlugin from '@bitrix24/b24ui-nuxt/vue-plugin'
import { createHead, renderSSRHead } from '@unhead/vue/server'
import { resolvePageComponent } from 'laravel-vite-plugin/inertia-helpers'
import { createSSRApp, h } from 'vue'
import { renderToString } from 'vue/server-renderer'
import type { DefineComponent } from 'vue'

const appName = import.meta.env.VITE_APP_NAME || 'Laravel x Bitrix24 UI'

createServer(
  (page) => {
    const head = createHead()
    return createInertiaApp({
      page,
      render: renderToString,
      title: (title) => (title ? `${title} - ${appName}` : appName),
      resolve: (name) =>
        resolvePageComponent(
          `./pages/${name}.vue`,
          import.meta.glob<DefineComponent>('./pages/**/*.vue')
        ),
      setup: ({ App, props, plugin }) =>
        createSSRApp({ render: () => h(App, props) })
          .use(plugin)
          .use(head)
          .use(b24UiPlugin)
    }).then(async (app) => {
      const payload = await renderSSRHead(head)
      app.head.push(payload.headTags)
      return app
    })
  },
  { cluster: true }
)
```

```ts [inertia/app/ssr.ts (AdonisJS Inertia)] {4,14,27,29,30,31,32,33}
import { createInertiaApp } from '@inertiajs/vue3'
import createServer from '@inertiajs/vue3/server'
import b24UiPlugin from '@bitrix24/b24ui-nuxt/vue-plugin'
import { createHead, renderSSRHead } from '@unhead/vue/server'
import { resolvePageComponent } from '@adonisjs/inertia/helpers'
import { createSSRApp, h } from 'vue'
import { renderToString } from 'vue/server-renderer'
import type { DefineComponent } from 'vue'

const appName = import.meta.env.VITE_APP_NAME || 'AdonisJS x Bitrix24 UI'

createServer(
  (page) => {
    const head = createHead()
    return createInertiaApp({
      page,
      render: renderToString,
      title: (title) => (title ? `${title} - ${appName}` : appName),
      resolve: (name) =>
        resolvePageComponent(
          `../pages/${name}.vue`,
          import.meta.glob<DefineComponent>('../pages/**/*.vue')
        ),
      setup: ({ App, props, plugin }) =>
        createSSRApp({ render: () => h(App, props) })
          .use(plugin)
          .use(head)
          .use(b24UiPlugin)
    }).then(async (app) => {
      const payload = await renderSSRHead(head)
      app.head.push(payload.headTags)
      return app
    })
  },
  { cluster: true }
)
```

::

### Color Scheme Detection

The same goes to the color scheme detection. To avoid flashings in the SSR because of the selected color scheme difference, you will need to detect the user's color scheme before the application initialization. 

Adding the script below to the `<head>` of your document will detect if the user is using dark theme, and therefore, render the SSR in the dark theme as well.

::code-group{sync="vite"}

```html [index.html]
<script>
const theme = localStorage.getItem('vueuse-color-scheme') || 'auto'
if (theme === 'dark' || (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
  document.documentElement.classList.add('dark')
} else {
  document.documentElement.classList.remove('dark')
}
</script>
```

```html [resources/views/app.blade.php (Laravel Inertia)] {8,9,10,11,12,13,14,15}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    @inertiaHead
    @vite('resources/js/app.ts')
    <script>
      const theme = localStorage.getItem('vueuse-color-scheme') || 'auto'
      if (theme === 'dark' || (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark')
      } else {
        document.documentElement.classList.remove('dark')
      }
    </script>
  </head>
  <body>
  <div class="isolate">
    @inertia
  </div>
  </body>
</html>
```

```html [resources/views/inertia_layout.edge (AdonisJS Inertia)] {8,9,10,11,12,13,14,15}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    @inertiaHead()
    @vite(['inertia/app/app.ts', `inertia/pages/${page.component}.vue`])
    <script>
      const theme = localStorage.getItem('vueuse-color-scheme') || 'auto'
      if (theme === 'dark' || (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark')
      } else {
        document.documentElement.classList.remove('dark')
      }
    </script>
  </head>
  <body>
    @inertia({ class: 'isolate' })
  </body>
</html>
```

::
